(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[508],{8168:function(e,t,l){Promise.resolve().then(l.bind(l,4153))},4153:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return f}});var n=l(7437),r=l(2265),o=l(2737),a=l.n(o),i=l(6648),s=e=>{let{imageSrc:t,alt:l,placeholder:r}=e;return(0,n.jsxs)("div",{className:"relative w-full pb-[150%]",children:[" ",t?(0,n.jsx)(i.default,{src:t,alt:l,title:l,fill:!0,className:"absolute inset-0 object-cover"}):(0,n.jsx)("div",{className:"absolute inset-0 flex",title:l,children:r})]})};let c=e=>new Promise(t=>setTimeout(t,e));async function u(e,t,l){var n,r;let o,a;let i="",s=e?e.replace(/["=]/g,""):void 0;if(s)i="isbn:".concat(s);else{if(!t||!l)return null;let e=l?l.split(",")[0].trim():"",n=t.replace(/\s*\([^)]*\)/g,"").trim();i="intitle:".concat(encodeURIComponent(n),"+inauthor:").concat(encodeURIComponent(e))}console.log("Google Books API query: ".concat(i));let u=0;for(;u<5;)try{if(o=await fetch("https://www.googleapis.com/books/v1/volumes?q=".concat(i,"&fields=items(volumeInfo/imageLinks/thumbnail)")),429===o.status){u++;let e=o.headers.get("Retry-After"),t=e?1e3*parseInt(e,10):2e3*u;await c(t)}else{a=await o.json();break}}catch(e){return console.error("Fetch error:",e),null}let d=(null==a?void 0:a.items)?a.items[0]:null;return(null==d?void 0:null===(r=d.volumeInfo)||void 0===r?void 0:null===(n=r.imageLinks)||void 0===n?void 0:n.thumbnail)||null}var d=l(8762);l(8877);var h=()=>(0,n.jsx)("div",{className:"flex justify-center items-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"})}),f=()=>{let e=(0,d.Z)(),[t,l]=(0,r.useState)(a()().year()),[o,i]=(0,r.useState)([]),[c,f]=(0,r.useState)([]),[m,v]=(0,r.useState)({}),[w,p]=(0,r.useState)(!0),[g,x]=(0,r.useState)({width:100,height:150,columns:1,rows:1}),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=Array.from(new Set(e.filter(e=>e["Date Read"]&&a()(e["Date Read"],"YYYY/MM/DD",!0).isValid()).map(e=>a()(e["Date Read"],"YYYY/MM/DD").year()))).sort((e,t)=>t-e);if(i(t),t.length>0){let n=t[0];l(n),y(n,e)}},[e]);let j=(0,r.useCallback)(()=>{let e=c.length,t=b.current?b.current.clientWidth:window.innerWidth,l=b.current?b.current.clientHeight:window.innerHeight;e>0&&(console.log(t,l),x(function(e,t,l,n){let r=1,o=t,a=1;for(;r<=o;){let i=Math.floor((r+o)/2);Math.floor(e/(i*l))*Math.floor(t/i)>=n?(a=i,r=i+1):o=i-1}let i=a*l,s=Math.floor(e/i);return{width:i,height:a,columns:s,rows:Math.ceil(n/s)}}(t,l,2/3,e)))},[c]);(0,r.useEffect)(()=>(window.addEventListener("resize",j),j(),()=>window.removeEventListener("resize",j)),[c,j]);let y=async(e,t)=>{let l=t.filter(t=>a()(t["Date Read"],"YYYY/MM/DD").year()===e);f(l),v((await Promise.all(l.map(async e=>{console.log("Fetching cover for ISBN: ".concat(e.ISBN,", Title: ").concat(e.Title,", Author: ").concat(e["Author l-f"]));let t=await u(e.ISBN,e.Title,e["Author l-f"]);return{id:e["Book Id"],coverUrl:t}}))).reduce((e,t)=>{let{id:l,coverUrl:n}=t;return l&&(e[l]=n),e},{})),p(!1),j()};return(0,n.jsxs)("div",{className:"p-8 max-w-screen-lg mx-auto h-screen overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex flex-wrap justify-center items-center mb-8",children:[(0,n.jsx)("h1",{children:"Your"}),(0,n.jsx)("select",{value:t,onChange:t=>{let n=parseInt(t.target.value,10);l(n),p(!0),y(n,e)},className:"ml-4 text-4xl font-bold bg-transparent border-none focus:outline-none custom-dropdown",children:o.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsx)("h1",{children:"in Books"})]}),w?(0,n.jsx)("div",{children:(0,n.jsx)(h,{})}):(0,n.jsx)("div",{ref:b,style:{display:"grid",gridTemplateColumns:"repeat(".concat(g.columns,", ").concat(g.width,"px)"),gridTemplateRows:"repeat(".concat(g.rows,", ").concat(g.height,"px)")},children:c.map(e=>(0,n.jsx)("div",{style:{width:g.width,height:g.height},className:"flex justify-center items-center",children:(0,n.jsx)(s,{imageSrc:m[e["Book Id"]],alt:"".concat(e.Title," by ").concat(e.Author),placeholder:(0,n.jsx)("div",{className:"placeholder-box",children:e.Title})})},e["Book Id"]))})]})}},8762:function(e,t,l){"use strict";var n=l(2265),r=l(8355),o=l.n(r);t.Z=()=>{let[e,t]=(0,n.useState)([]),l="/goodreads/goodreads_data";return(0,n.useEffect)(()=>{fetch("".concat(l,"/2024-05-26-goodreads_library_export.csv")).then(e=>e.text()).then(e=>{t(o().parse(e,{header:!0}).data.filter(e=>e.ISBN||e.Title||e.Author))})},[l]),e}},8877:function(){}},function(e){e.O(0,[569,704,648,971,23,744],function(){return e(e.s=8168)}),_N_E=e.O()}]);